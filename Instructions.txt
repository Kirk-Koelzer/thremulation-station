1. Once the lab has finished building ensure you can access Kibana in your browswer by browsing to localhost:5601

2. The username and password for Kibana are vagrant

3. Once in Kibana click the 3 hash dropdown menu in the upper left corner of the screen and go to the discover tab

4. Verify you are seeing logs

5. Now from a command prompt run vagrant ssh elastic to ssh into your logger/attacker box

6. If it works you will see a prompt like the following [vagrant@elk ~]$ 

7. Enter pwsh to drop into a Powershell prompt. Now it is time to choose what test or attack you would like to run against the remote Windows 10 box

8. Within your Powershell prompt you can utilize the Invoke-AtomicTest-By cmdlet to search for available techniques and tests to run by Tactic, Technique, Platform or Group. 

9. As an example you can run Invoke-AtomicTest-By -Tactic execution -Platform Windows -ShowDetailsBrief or you can use the mitre-assistant tool to explore the enterprise mitre att&ck matrix such as mitre-assistant -m enterprise -t "1059.001"

10. For this demonstration we will conduct a Mimikatz test for technique T1059.001 TestNumber 1 using Powershell to download Mimikatz and then dump credentials on the system

11. Before we can run this test against the Windows 10 box we first need to setup a Powershell Session over SSH to the Windows 10 box

12. $sess = New-PSSession -Hostname 192.168.33.11 -Username vagrant 

13. Here we create a variable $sess and set it equal to our new session which we create using the Powershell cmdlet New-PSSession and give it the hostname in this case the IP of our Windows 10 box and the username which is vagrant

14. It will prompt you to accept the host and ask you to enter the password which is vagrant 

15. This will create a Powershelll session over ssh and store it in the variable $sess for us

16. Now in order to launch an attack against a remmote host the syntax is as follows

17. Invoke-AtomicTest T1059.001 -TestNumbers 1 -Session $sess

18. Invoke-AtomicTest (Run Atomic Test) T1059.001 (Technique ID) -TestNumbers 1 (TestNumber) -Session $sess (Over our Session)

19. Run Invoke-AtomicTest T1059.001 -TestNumbers 1 -Session $sess

20. Once complete now go back to your discover tab within the Kibana window in your browser 

21. In the search bar type Mimikatz and hit enter where you should see it filter to only show the events with pertaining to the Mimikatz attack you just executed

22. Now you could dig into all of the events and start building detections based off of what logs its behavior produces after which you could run the test again to verify your detection logic is sound

23. You can do this by buidling your query using KQL or Luscene and then going to the Detections tab in Kibana and selsecting Manage Detection Rules then selecting Create New Rules

24. Now most if not all AtomicRedTeam tests come with a cleanup command to clean up your test system before executing another test

25. In order to cleanup our Mimikatz test we can run the same command we used to execute it this time with the -Cleanup option at the end

26. Run Invoke-AtomicTest T1059.001 -TestNumbers 1 -Session $sess -Cleanup

27. Congratulaltions you have executed your first test and hopefully wrote meaningful behavior based detections in order to help detect that activity in the future 

28. Wash, rinse and repeat 